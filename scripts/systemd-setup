#!/bin/bash
# systemd-setup.sh - DEPRECATED
# This script is no longer needed. The ./install script now handles
# user-level systemd daemon setup automatically.

echo "⚠️  This script is deprecated."
echo "The main ./install script now handles user-level systemd setup automatically."
echo "Please run ./install from the project root instead."
echo
echo "For manual user-level systemd setup, see the installation script source."
exit 1
    
    # Test daemon once as the user
    if sudo -u "$USER_NAME" doh daemon --once --verbose; then
        print_success "Daemon test successful"
    else
        print_warning "Daemon test had issues - check configuration"
    fi
    
    print_step "Starting and enabling DOH daemon timer"
    
    # Start the timer
    if systemctl start "$TIMER_NAME"; then
        print_success "Timer started successfully"
    else
        print_warning "Failed to start timer - you can start it manually later"
    fi
    
    # Enable the timer to start on boot
    if systemctl enable "$TIMER_NAME"; then
        print_success "Timer enabled for automatic startup"
    else
        print_warning "Failed to enable timer - you can enable it manually later"
    fi
    
    echo
    echo -e "${GREEN}${BOLD}Systemd service and timer setup complete and running!${NC}"
    echo
    echo "The DOH daemon is now running and will monitor every 10 minutes."
    echo "It will automatically start on system boot."
    echo
    echo "To manage the DOH daemon:"
    echo
    echo -e "${BLUE}Check timer status:${NC}"
    echo "  sudo systemctl status $TIMER_NAME"
    echo "  sudo systemctl list-timers $TIMER_NAME"
    echo
    echo -e "${BLUE}View logs:${NC}"
    echo "  sudo journalctl -u $SERVICE_NAME -f"
    echo
    echo -e "${BLUE}Run once manually:${NC}"
    echo "  sudo systemctl start $SERVICE_NAME"
    echo
    echo -e "${BLUE}Stop the timer:${NC}"
    echo "  sudo systemctl stop $TIMER_NAME"
    echo
    echo -e "${BLUE}Disable timer:${NC}"
    echo "  sudo systemctl disable $TIMER_NAME"
    echo
    echo -e "${YELLOW}Note: The service runs as user '$USER_NAME' every 10 minutes and monitors directories in their ~/.doh/ config${NC}"
    echo
    echo "To add directories to monitoring:"
    echo "  sudo -u $USER_NAME doh add [directory]"
    echo
    echo "To check what's being monitored:"
    echo "  sudo -u $USER_NAME doh list"
}

main "$@"
